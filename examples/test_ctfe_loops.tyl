// CTFE Tests with Loops

// Sum using while loop
comptime fn sum_while n: int -> int:
    result := 0
    i := 1
    while i <= n:
        result = result + i
        i = i + 1
    return result

// Factorial using while loop
comptime fn fact_while n: int -> int:
    result := 1
    i := 2
    while i <= n:
        result = result * i
        i = i + 1
    return result

// Fibonacci using iteration (much faster than recursion)
comptime fn fib_iter n: int -> int:
    if n <= 1:
        return n
    a := 0
    b := 1
    i := 2
    while i <= n:
        temp := a + b
        a = b
        b = temp
        i = i + 1
    return b

// Count digits in a number
comptime fn count_digits n: int -> int:
    if n == 0:
        return 1
    count := 0
    num := n
    if num < 0:
        num = 0 - num
    while num > 0:
        count = count + 1
        num = num / 10
    return count

// Reverse digits of a number
comptime fn reverse_digits n: int -> int:
    result := 0
    num := n
    if num < 0:
        num = 0 - num
    while num > 0:
        result = result * 10 + num % 10
        num = num / 10
    return result

// Check if palindrome number
comptime fn is_palindrome n: int -> int:
    if n < 0:
        return 0
    if n == reverse_digits(n):
        return 1
    return 0

// Compile-time constants using loops
SUM_1000 :: sum_while(1000)
FACT_12 :: fact_while(12)
FIB_30 :: fib_iter(30)
DIGITS_12345 :: count_digits(12345)
REVERSE_12345 :: reverse_digits(12345)
IS_PALINDROME_12321 :: is_palindrome(12321)
IS_PALINDROME_12345 :: is_palindrome(12345)

fn main:
    println("=== CTFE Loop Tests ===")
    println("")
    
    println("sum_while(1000) = ", SUM_1000)
    println("fact_while(12) = ", FACT_12)
    println("fib_iter(30) = ", FIB_30)
    println("count_digits(12345) = ", DIGITS_12345)
    println("reverse_digits(12345) = ", REVERSE_12345)
    println("is_palindrome(12321) = ", IS_PALINDROME_12321)
    println("is_palindrome(12345) = ", IS_PALINDROME_12345)
    println("")
    
    println("--- Direct calls ---")
    println("sum_while(50) = ", sum_while(50))
    println("fib_iter(20) = ", fib_iter(20))
    println("is_palindrome(1001) = ", is_palindrome(1001))
    println("")
    
    println("=== Loop Tests Complete! ===")
